name: ğŸ›¡ï¸ RWC - AuditorÃ­a de SoberanÃ­a

on:
  workflow_dispatch:
    inputs:
      reason:
        description: 'Motivo de la auditorÃ­a'
        required: true
        default: 'ValidaciÃ³n de integridad Lattice v8.5'

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  quality_gate:
    name: ğŸ” Aduana y Pruebas
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Clonando ADN
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ğŸ“¦ Instalando pnpm
        uses: pnpm/action-setup@v4
        with:
          version: 10.26.1

      - name: ğŸŸ¢ Configurando Node.js con CachÃ©
        uses: actions/setup-node@v4
        with:
          node-version: 22.14.0
          cache: 'pnpm'

      - name: ğŸ› ï¸ Instalando Dependencias
        run: pnpm install --frozen-lockfile

      - name: ğŸ‘® Ejecutando Aduana Global (Full Scan)
        run: pnpm aduana:global:total

      - name: ğŸ§ª Ejecutando Pruebas Espejo (Affected)
        run: pnpm nx affected -t test --base=main --head=HEAD --parallel=3